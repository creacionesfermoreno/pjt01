
@{
    ViewBag.Title = "Finanzas";
    Layout = "~/Views/Shared/__LayoutAppFitPlataformaFit.cshtml";
}

<link href="@Url.Content("~/Content/cssKendo/kendo.common.min.css")" rel="stylesheet" />
<link href="@Url.Content("~/Content/cssKendo/kendo.dataviz.default.min.css")" rel="stylesheet" />
<link href="@Url.Content("~/Content/cssKendo/kendo.dataviz.min.css")" rel="stylesheet" />
<link href="@Url.Content("~/Content/cssKendo/kendo.default.min.css")" rel="stylesheet" />

<style>
    .k-block, .k-button, .k-textbox, .k-drag-clue, .k-touch-scrollbar, .k-window, .k-window-titleless .k-window-content, .k-window-action, .k-inline-block, .k-grid .k-filter-options, .k-grouping-header .k-group-indicator, .k-autocomplete, .k-multiselect, .k-combobox, .k-dropdown, .k-dropdown-wrap, .k-datepicker, .k-timepicker, .k-colorpicker, .k-datetimepicker, .k-notification, .k-numerictextbox, .k-picker-wrap, .k-numeric-wrap, .k-colorpicker, .k-list-container, .k-calendar-container, .k-calendar td, .k-calendar .k-link, .k-treeview .k-in, .k-editor-inline, .k-tooltip, .k-tile, .k-slider-track, .k-slider-selection, .k-upload {
        border-radius: 3px;
    }

    .modal-body {
    }

    .modal-backdrop {
        display: none;
    }

    .card-body {
        margin-top: -5px;
        margin-bottom: -5px;
    }

    .k-dropdown .k-input, .k-selectbox .k-input {
        /* background: none; */
        background-color: #fff;
        font-weight: bold;
    }

    .k-dropdown-wrap .k-input, .k-picker-wrap .k-input, .k-numeric-wrap .k-input {
        border-radius: 3px 0 0 3px;
        font-weight: bold;
    }

    .k-autocomplete {
        background-image: url(textures/highlight.png);
        background-image: none,linear-gradient(to bottom,#e2e1e199 0,#e2e1e199 100%);
        background-position: 50% 50%;
        background-color: #e3e3e3;
        border: 1px solid #cac9c9;
        color: #fff;
    }

    .k-header, .k-grid-header, .k-toolbar, .k-dropdown-wrap, .k-picker-wrap, .k-numeric-wrap, .k-grouping-header, .k-pager-wrap, .k-textbox, .k-button, .k-progressbar, .k-draghandle, .k-state-highlight, .k-tabstrip-items .k-item, .k-panelbar .k-tabstrip-items .k-item, .km-pane-wrapper > .km-pane > .km-view > .km-content {
        background-image: url(textures/highlight.png);
        background-image: none,-webkit-linear-gradient(top,#0075ff 0,#0075ff 100%);
        background-image: none,-moz-linear-gradient(top,#0075ff 0,#0075ff 100%);
        background-image: none,-o-linear-gradient(top,#0075ff 0,#0075ff 100%);
        background-image: none,linear-gradient(to bottom,#0075ff 0,#0075ff 100%);
        background-position: 50% 50%;
        background-color: #e3e3e3;
        color: #fff;
    }

        .k-header, .k-grid-header-wrap, .k-grid .k-grouping-header, .k-grid-header, .k-pager-wrap, .k-pager-wrap .k-textbox, .k-pager-wrap .k-link, .k-grouping-header .k-group-indicator, .k-gantt-toolbar .k-state-default {
            border-color: #e8eaee;
            background-color: #0075ff;
            color: #fff;
        }

    .modal {
        display: none;
        background-color: rgba(0, 0, 0, 0.77);
    }

    .k-block, .k-header, .k-grid-header, .k-toolbar, .k-grouping-header, .k-pager-wrap, .k-button, .k-draghandle, .k-treemap-tile, html .km-pane-wrapper .k-header {
        background-color: #0075ff;
        color: #fff;
    }

        .k-grid-header th.k-header > .k-link {
            display: block;
            min-height: 18px;
            line-height: 18px;
            margin: -0.5em -0.6em -0.4em -0.6em;
            padding: .1em .1em .1em .1em;
            overflow: hidden;
            text-overflow: ellipsis;
            color: #fff;
        }

        .k-grid-header table, .k-grid-content table, .k-grid-footer table, .k-grid-content-locked > table {
            table-layout: fixed;
        }



        .k-grid-toolbar:first-child, .k-grouping-header + .k-grid-toolbar {
            border-width: 0 0 1px;
            border-radius: 0px;
            background-color: #d7eafa;
            height: 10px;
        }

    .k-block, .k-header, .k-grid-header, .k-toolbar, .k-grouping-header, .k-pager-wrap, .k-button, .k-draghandle, .k-treemap-tile, html .km-pane-wrapper .k-header {
        background-color: rgba(227, 227, 227, 0);
    }

    #txtFechaInicioProcFreezing .k-header, .k-grid-header, .k-toolbar, .k-dropdown-wrap, .k-picker-wrap, .k-numeric-wrap, .k-grouping-header, .k-pager-wrap, .k-textbox, .k-button, .k-progressbar, .k-draghandle, .k-autocomplete, .k-state-highlight, .k-tabstrip-items .k-item, .k-panelbar .k-tabstrip-items .k-item, .km-pane-wrapper > .km-pane > .km-view > .km-content {
        background-image: url(textures/highlight.png);
        background-image: none,-webkit-linear-gradient(top,#0075ff 0,#0075ff 100%);
        background-image: none,-moz-linear-gradient(top,#0075ff 0,#0075ff 100%);
        background-image: none,-o-linear-gradient(top,#0075ff 0,#0075ff 100%);
        background-image: none,linear-gradient(to bottom,#0075ff 0,#0075ff 100%);
        background-position: 50% 50%;
        background-color: #ffffff;
    }

    .k-state-selected {
        color: #FFFFFF;
        background-color: #0075ff;
        border-color: #0075ff;
    }


    .k-grid tr td {
        border-bottom: 1px solid #eaeaea;
        border-left: 1px solid #eaeaea;
        border-style: solid;
    }

    tr {
        height: 16px;
        font-size: 13px;
    }

    .k-textbox, .k-autocomplete, .k-dropdown-wrap, .k-picker-wrap, .k-numeric-wrap {
        border-width: 1px;
        border-style: solid;
        padding: 0 1.9em 0 0;
        font-weight: bold;
    }

    .k-state-focused.k-state-selected, .k-list > .k-state-focused.k-state-selected, .k-listview > .k-state-focused.k-state-selected, td.k-state-focused.k-state-selected {
        webkit-box-shadow: inset 0 0 3px 4px #0075ff;
        box-shadow: inset 0 0 3px 4px #0075ff;
    }

    .k-state-selected, .k-state-selected:link, .k-state-selected:visited, .k-list > .k-state-selected, .k-list > .k-state-highlight, .k-panel > .k-state-selected, .k-ghost-splitbar-vertical, .k-ghost-splitbar-horizontal, .k-draghandle.k-state-selected:hover, .k-scheduler .k-scheduler-toolbar .k-state-selected, .k-scheduler .k-today.k-state-selected, .k-marquee-color {
        color: #fff;
        background-color: #0075ff;
        border-color: #0075ff;
    }
    /** SPINNER CREATION **/
    .loader {
        position: relative;
        text-align: center;
        margin: 15px auto 35px auto;
        z-index: 9999;
        display: block;
        width: 80px;
        height: 80px;
        border: 10px solid rgba(0, 0, 0, .3);
        border-radius: 50%;
        border-top-color: #000;
        animation: spin 1s ease-in-out infinite;
        -webkit-animation: spin 1s ease-in-out infinite;
    }


    /** MODAL STYLING **/
    .modal-content {
        border-radius: 0px;
        box-shadow: 0 0 20px 8px rgba(0, 0, 0, 0.7);
    }


    [dir=ltr] .modal-lg, [dir=ltr] .modal-xl {
        max-width: 950px;
    }

    a {
        color: transparent;
        text-decoration: none;
    }

    .small-box {
        border-radius: .25rem;
        box-shadow: 0 0 1px rgba(0,0,0,.125), 0 1px 3px rgba(0,0,0,.2);
        display: block;
        margin-bottom: 20px;
        position: relative;
    }

    .small-box > .inner {
        padding: 10px;
    }
    .small-box h3, .small-box p {
        z-index: 5;
    }
    .small-box h3 {
        font-size: 2.2rem;
        font-weight: 700;
        margin: 0 0 10px 0;
        padding: 0;
        white-space: nowrap;
    }
    .small-box p {
        font-size: 1rem;
    }
    .small-box .icon {
        color: rgba(0,0,0,.15);
        z-index: 0;
    }
    .small-box > .small-box-footer {
        background: rgba(0,0,0,.1);
        color: rgba(255,255,255,.8);
        display: block;
        padding: 3px 0;
        position: relative;
        text-align: center;
        text-decoration: none;
        z-index: 10;
    }
    .small-box .icon > i.fa, .small-box .icon > i.fab, .small-box .icon > i.far, .small-box .icon > i.fas, .small-box .icon > i.glyphicon, .small-box .icon > i.ion {
        font-size: 70px;
        top: 20px;
    }
    .small-box .icon > i {
        font-size: 90px;
        position: absolute;
        right: 15px;
        top: 15px;
        transition: all .3s linear;
    }
        .small-box:hover {
            text-decoration: none;
        }
    .bg-gradient-success2 {
        background: #28a745 linear-gradient(180deg,#48b461,#28a745) repeat-x !important;
    }
    .bg-gradient-success2 {
        color: #fff;
    }
    .bg-danger2, .bg-danger2 > a {
        color: #fff !important;
    }
    .bg-danger2 {
        background-color: #dc3545 !important;
    }
    .bg-info2 {
        background-color: #17a2b8 !important;
    }
    .bg-info2, .bg-info2 > a {
        color: #fff !important;
    }
    .small-box:hover .icon > i, .small-box:hover .icon > i.fa, .small-box:hover .icon > i.fab, .small-box:hover .icon > i.fad, .small-box:hover .icon > i.fal, .small-box:hover .icon > i.far, .small-box:hover .icon > i.fas, .small-box:hover .icon > i.ion {
        transform: scale(1.1);
    }
</style>


<div class="page__header page__header-nav mb-0">
    <div class="container-fluid page__container">
        <div class="navbar navbar-secondary navbar-light navbar-expand-sm p-0 d-none d-md-flex" id="secondaryNavbar">
            <ul class="nav navbar-nav">
                <li class="nav-item">
                    <button style="color: #ffffff;background-color: #ff0200;font-size: 1.0rem;border: 0px #ff0200 solid;height: 33px;padding: 5px;cursor:pointer;" class="navbar-toggler navbar-toggler-custom d-flex mr-navbar" type="button" data-toggle="sidebar">
                        Operaciones
                    </button>
                </li>
                <li class="nav-item" data-controlmodulo="45833cdd-55db-4a67-a879-f1ae9353f8bf">
                    <a href="@Url.Action("checking","gestionce",new {id= HttpContext.Current.Request.Cookies["_SubDominio_Business"].Value})" class="nav-link">Clientes</a>
                </li>
                <li class="nav-item" data-controlmodulo="9e69cfd8-b063-44df-a7f2-a3a10d1eb899" style="display:none;">
                    <a class="nav-link " href="@Url.Action("posfitness","pos",new {id= HttpContext.Current.Request.Cookies["_SubDominio_Business"].Value})">Punto de venta</a>
                </li>
                <li class="nav-item" data-controlmodulo="7611dfbe-186f-4abe-8e2e-e64ad7281728" style="display:none;">
                    <a class="nav-link" href="@Url.Action("caja","gestionce",new {id= HttpContext.Current.Request.Cookies["_SubDominio_Business"].Value})">Caja</a>
                </li>
                <li class="nav-item" data-controlmodulo="93c0d848-83aa-45eb-a83a-ded00a6b6e23" style="display:none;">
                    <a class="nav-link" href="@Url.Action("nutricion","gestionce",new {id= HttpContext.Current.Request.Cookies["_SubDominio_Business"].Value})">Medidas y Nutrición</a>
                </li>
                <li class="nav-item" data-controlmodulo="947dc11f-3e14-4fe7-bedc-ae3d81219bee" style="display:none;">
                    <a class="nav-link " href="@Url.Action("Index","inventariofit",new {id= HttpContext.Current.Request.Cookies["_SubDominio_Business"].Value})">Inventario</a>
                </li>

                <li class="nav-item" data-controlmodulo="39497bd3-94ab-4236-a1d4-4623d854f91e" style="display:none;">
                    <a class="nav-link" href="@Url.Action("agendacomercial","gestionce",new {id= HttpContext.Current.Request.Cookies["_SubDominio_Business"].Value})">Agenda Comercial</a>
                </li>
                <li class="nav-item" data-controlmodulo="bbc035e6-68ea-4885-917f-005ad3fcfb66" style="display:none;">
                    <a href="@Url.Action("metascomerciales","gestionce",new {id= HttpContext.Current.Request.Cookies["_SubDominio_Business"].Value})" class="nav-link">Metas</a>
                </li>
                <li class="nav-item" data-controlmodulo="bd61dc23-54d9-4901-9c35-b8d228b3a924" style="display:none;">
                    <a href="@Url.Action("marketing","gestionce",new {id= HttpContext.Current.Request.Cookies["_SubDominio_Business"].Value})" class="nav-link">Marketing</a>
                </li>
                <li class="nav-item" data-controlmodulo="e1eadd0d-39b3-498d-b09b-9b3b28610b9b" style="display:none;">
                    <a href="@Url.Action("informesfit","gestionce",new {id= HttpContext.Current.Request.Cookies["_SubDominio_Business"].Value})" class="nav-link">Informes</a>
                </li>
                <li class="nav-item" data-controlmodulo="600dabf4-7dc3-4dc0-a0ba-74b782955e52" style="display:none;">
                    <a class="nav-link" href="@Url.Action("pagospersonal","gestionce",new {id= HttpContext.Current.Request.Cookies["_SubDominio_Business"].Value})">Pagos</a>
                </li>

                <li class="nav-item active" data-controlmodulo="b1f65597-fd27-46ca-90d0-a0f2f1039ef7" style="display:none;">
                    <a class="nav-link active" href="@Url.Action("finanzas","gestionce",new {id= HttpContext.Current.Request.Cookies["_SubDominio_Business"].Value})">Finanzas</a>
                </li>

                <li class="nav-item" data-controlmodulo="4c01e8de-9440-4927-a2f2-d6241d925c39" style="display:none;">
                    <a class="nav-link" href="@Url.Action("estadisticas","gestionce",new {id= HttpContext.Current.Request.Cookies["_SubDominio_Business"].Value})">Estadísticas</a>
                </li>

            </ul>
        </div>
    </div>
</div>


<input type="hidden" id="hd_ventas" />
<input type="hidden" id="hd_egresos" />


<div class="container-fluid page__container" style="background-color:#e9ebee;">
    <br />

    <div class="row">
        <div class="col-lg-12">
            <div class="card">
                <div class="card-header card-header-tabs-basic nav" role="tablist" style="background-color: #fff;">
                    <a data-controlmodulo="1a35cf52-b26f-4918-a43c-067b8b50c982" style="display:none;" href="#divPuntoEquilibrio" id="liPuntoEquilibrio" onclick="ClickObtenerOrigen(10)" class="active" data-toggle="tab" role="tab" aria-controls="activity_all" aria-selected="true">Punto de Equilibrio</a>
                    <a data-controlmodulo="a8c5a9f9-a0a9-43aa-932a-b27e6e0e13f1" style="display:none;" href="#divGastosAdmin" id="liGastosAdmin" onclick="ClickObtenerOrigen(50)" data-toggle="tab" role="tab" aria-controls="activity_all" aria-selected="true">Historial de Gastos Administrativos</a>
                </div>
                <div class="card-body tab-content" style="background-color: #f5f5f5;">
                    <div class="tab-pane active show fade" id="divPuntoEquilibrio">
                        <div class="my-2">
                            <table width="100%" border="0">
                                <tbody>
                                    <tr>
                                        <td style="width:11%;">
                                            <span class="k-widget k-datepicker k-header" style="width: 99%; font-size: 11px;"><span class="k-picker-wrap k-state-default k-state-hover"><input id="txtFechaDesde_Tab1" type="text" placeholder="Escriba Fecha Inicio" style="width: 100%; font-size: 11px;" data-role="datepicker" class="k-input" role="combobox" aria-expanded="false" aria-owns="txtFechaDesde_Tab1_dateview" aria-disabled="false" aria-readonly="false"><span unselectable="on" class="k-select" role="button" aria-controls="txtFechaDesde_Tab1_dateview"><span unselectable="on" class="k-icon k-i-calendar">select</span></span></span></span>
                                        </td>
                                        <td style="width:11%;">
                                            <span class="k-widget k-datepicker k-header" style="width: 99%; font-size: 11px;"><span class="k-picker-wrap k-state-default"><input id="txtFechaHasta_Tab1" type="text" placeholder="Escriba Fin" style="width: 100%; font-size: 11px;" data-role="datepicker" class="k-input" role="combobox" aria-expanded="false" aria-owns="txtFechaHasta_Tab1_dateview" aria-disabled="false" aria-readonly="false"><span unselectable="on" class="k-select" role="button" aria-controls="txtFechaHasta_Tab1_dateview"><span unselectable="on" class="k-icon k-i-calendar">select</span></span></span></span>
                                        </td>
                                        <td style="width:3%;">
                                            <button id="btnBuscarPuntoEquilibrio" type="button" onclick="ListarPuntoEquilibrio()" class="btn btn-primary btn-sm" title="Buscar" style="font-size:11px;background-color: rgb(0 117 255);border-color: rgb(0 117 255);">Buscar</button>
                                        </td>
                                        <td style="width:4%;" align="center">
                                            
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <div class="container-fluid">
                            <div class="row my-4">
                                <div class="col-lg-4 col-6">
                                    <div class="small-box" style="background-color:#0176ff;border:1px #0176ff solid;color:#fff;">
                                        <div class="inner">
                                            <h3 style="color:#fff;">s/<span id="txt_ventas">0.00</span></h3>
                                            <p>INGRESOS</p>
                                        </div>
                                        <div class="icon">
                                            <i class="fas fa-shopping-cart"></i>
                                        </div>
                                    </div>
                                </div>
                                <!-- ./col -->
                                <div class="col-lg-4 col-6">
                                    <!-- small box -->
                                    <div class="small-box" style="background-color:#ff0200;border:1px #ff0200 solid;color:#fff;">
                                        <div class="inner">
                                            <h3 style="color:#fff;">s/<span id="txt_egresos">0.00</span></h3>

                                            <p>GASTOS</p>
                                        </div>
                                        <div class="icon">
                                            <i class="fas fa-exclamation"></i>
                                        </div>
                                    </div>
                                </div>
                                <!-- ./col -->
                                <div class="col-lg-4 col-6">
                                    <!-- small box -->
                                    <div class="small-box" style="background-color:#5a5a5a;border:1px #5a5a5a solid;color:#fff;">
                                        <div class="inner">
                                            <h3 style="color:#fff;">s/<span id="txt_utilidad">0.00</span></h3>

                                            <p>UTILIDAD</p>
                                        </div>
                                        <div class="icon">
                                            <i class="fas fa-dollar-sign"></i>
                                        </div>
                                    </div>
                                </div>
                                <!-- ./col -->
                            </div>

                            <div class="row mb-4">
                                <div class="col">
                                    <h5 class="text-center">Lista de Ingresos</h5>
                                    <div id="gridVentas" style="width:100%;margin:1px;user-select:none;"></div>
                                </div>
                                <div class="col">
                                    <h5 class="text-center">Lista de Gastos</h5>
                                    <div id="gridEgresos" style="width:100%;margin:1px;user-select:none;"></div>
                                </div>
                            </div>
                        </div>

                    </div>
                    <div class="tab-pane fade" id="divGastosAdmin">

                        <div class="my-2">
                            <table style="width:100%;" border="0">
                                <tbody>
                                    <tr>
                                        <td style="width:10%;">
                                            <select id="ddlHistorial_TipoDocumento" style="font-size: 11px;font-weight:bold;width:99%;" class="k-dropdown" tabindex="6">
                                                <option value="0">Documentos</option>
                                                <option value="1">Recibo</option>
                                                <option value="2">Factura</option>
                                                <option value="3">Boleta</option>
                                                <option value="4">Recibo x Honorario</option>
                                            </select>
                                            <input id="hdHistorial_TipoDocumento" type="hidden" value="0" />
                                        </td>
                                        <td style="width:15%;">
                                            <input id="ddlHistorial_TipoGasto" value="0" style="width: 98%;font-size:11px;" />
                                            <input id="hdHistorial_TipoGasto" type="hidden" value="0" />
                                        </td>
                                        <td style="width:10%;">
                                            <input id="ddlHistorial_Counter" value="0" style="width: 98%;font-size:11px;" />
                                            <input id="hdHistorial_CountersTotales" type="hidden" value="" />
                                            <input id="hdHistorial_NombreVendedorTotales" type="hidden" value="" />
                                        </td>
                                        <td style="width:10%;">
                                            <input type="text" id="txtHistorial_FechaDesde_Tab2" placeHolder="Escriba Fecha" style="width:98%;font-size:11px;" class="k-datetime" />
                                        </td>
                                        <td style="width:10%;">
                                            <input type="text" id="txtHistorial_FechaHasta_Tab2" placeHolder="Escriba Fecha" style="width:98%;font-size:11px;" class="k-datetime" />
                                        </td>
                                        <td style="width:5%;">
                                            <button id="" type="button" onclick="uspReporteEgresoRangoFechas_Paginacion()" class="btn btn-primary btn-sm" title="Buscar">Buscar</button>
                                        </td>
                                        <td style="width:5%;" align="center">
                                            <button data-controlmodulo="" type="button" onclick="ExportarExcel_HistorialGastos()" class="btn btn-success btn-sm"  title="Exportar" style="font-size: 11px;"><i class="fas fa-file-excel mr-2"></i>Exportar</button>
                                        </td>
                                        <td style="width:35%;">
                                            <table style="width:100%;" border="0">
                                                <tr>
                                                    <td style="width:33%;">
                                                        <div style="width:98%;padding:5px;">                                                            
                                                            &nbsp;&nbsp;<label style="font-size:15px;font-weight:bold;">Sub Total</label>: <label style="font-size:15px;font-weight:bold;" id="lblTotalSubTotal">0.00</label>                                                            
                                                        </div>
                                                    </td>
                                                    <td style="width:33%;">
                                                        <div style="width:98%;padding:5px;">                                                           
                                                            &nbsp;&nbsp;<label style="font-size:15px;font-weight:bold;">Igv</label>: <label style="font-size:15px;font-weight:bold;" id="lblTotalIgv">0.00</label>                                                
                                                        </div>
                                                    </td>
                                                    <td style="width:33%;" valign="top">
                                                        <div style="width:98%;padding:5px;">
                                                            &nbsp;&nbsp;<label style="font-size:15px;font-weight:bold;">Total:</label> <label style="font-size:15px;font-weight:bold;" id="lblTotalDia">0.00</label>                                                            
                                                        </div>
                                                    </td>
                                                </tr>
                                            </table>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <table style="width:100%;">
                            <tr>
                                <td>
                                    <div>
                                        Cantidad: <label id="lblcantidadEgreso">0</label>
                                    </div>
                                </td>
                                <td align="right">
                                    <select id="ddlPaginacionEgresos" style="width:60px;"></select>
                                </td>
                            </tr>
                        </table>
                        <div id="gridHistorialEgresos"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="loadMe" tabindex="-1" role="dialog" aria-labelledby="loadMeLabel">
    <br /><br /><br /><br />
    <div class="modal-dialog modal-sm" role="document">
        <div class="modal-content">
            <div class="modal-body text-center">
                <img src="~/Content/appsfit_img/logoappsfitweb.png" style="width:255px;height:125px;" />
                <div class="loader"></div>
                <div clas="loader-txt">
                    <p>Cargando... <br><br><small>Espere por favor, este proceso puede tardar unos minutos</small></p>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {

    @System.Web.Optimization.Scripts.Render("~/Scripts/jquery.min.js")
    @System.Web.Optimization.Scripts.Render("~/Scripts/plugins/jsKendo/angular.min.js")
    @System.Web.Optimization.Scripts.Render("~/Scripts/plugins/jsKendo/kendo.all.min.js")

    @System.Web.Optimization.Scripts.Render("~/Scripts/plugins/jquery-ui/jquery-ui.js")
    @System.Web.Optimization.Scripts.Render("~/Scripts/plugins/jquery-ui/jquery-ui.min.js")

    @System.Web.Optimization.Scripts.Render("~/Resource/UserControl.Helper.js")
    @*@System.Web.Optimization.Scripts.Render("~/Resource/gimnasio/moduloCheking.js")*@

    @System.Web.Optimization.Scripts.Render("~/Scripts/bootstrap-notify-master/bootstrap-notify.js")
    @System.Web.Optimization.Scripts.Render("~/Scripts/bootstrap-notify-master/bootstrap-notify.min.js")
    @System.Web.Optimization.Scripts.Render("~/Scripts/jsBootstrap/jquery.bootstrap-growl.js")
    @System.Web.Optimization.Scripts.Render("~/Scripts/maskedinput.js")

    <script type="text/javascript">

        $(document).ready(function () {

            SEGListarPerfilMenu();

            var todayDate = new Date();
            var primerDia = new Date(todayDate.getFullYear(), todayDate.getMonth(), 1);
            var ultimoDia = new Date(todayDate.getFullYear(), todayDate.getMonth() + 1, 0);

            $("#txtFechaDesde_Tab1").kendoDatePicker();
            $('#txtFechaDesde_Tab1').data("kendoDatePicker").value(primerDia);

            $("#txtFechaHasta_Tab1").kendoDatePicker();
            $('#txtFechaHasta_Tab1').data("kendoDatePicker").value(ultimoDia);

            $('#btnBuscarPuntoEquilibrio').click();

            $("#txtHistorial_FechaDesde_Tab2").kendoDatePicker();
            $('#txtHistorial_FechaDesde_Tab2').data("kendoDatePicker").value(primerDia);

            $("#txtHistorial_FechaHasta_Tab2").kendoDatePicker();
            $('#txtHistorial_FechaHasta_Tab2').data("kendoDatePicker").value(ultimoDia);

            $('#ddlHistorial_TipoDocumento').kendoDropDownList();
            $('#ddlHistorial_TipoDocumento').data("kendoDropDownList").select(0);

            ListarTipoEgresos();
            ListarCountersTotales();
        });
        
       
        function SEGListarPerfilMenu() {

            var entidad = {};

            document.getElementById('loadMe').style.display = 'block';
            $('button[type="button"]').attr("disabled", true);
            var metodoCorrecto = function (msg) {

                $('button[type="button"]').attr("disabled", false);
                document.getElementById('loadMe').style.display = 'none';

                for (var i = 0; i < msg.length; i++) {

                    if (msg[i].Estado) {
                        $('[data-controlmodulo="' + msg[i].CodigoMenu + '"]').show('fast');

                    }
                }
            };
            var metodoError = function (msg) {
                alert(msg);
            };
            var request = {
                //request: entidad
            };
            LlamarAJAX("/gestionce/SEGListarPerfilMenu", request, metodoCorrecto, metodoError);

        }

        function ListarPuntoEquilibrio() {
            ListarGridVentas();
        }

        function ListarGridVentas() {
            var FechaDesde = kendo.toString($("#txtFechaDesde_Tab1").data('kendoDatePicker').value(), 'MM/dd/yyyy');
            var FechaHasta = kendo.toString($("#txtFechaHasta_Tab1").data('kendoDatePicker').value(), 'MM/dd/yyyy');

            $('#loadMe').css('display', 'block');
            $("#gridVentas").empty();
            $("#gridVentas").kendoGrid({
                dataSource: {
                    type: 'json',
                    transport: {
                        read: function (options) {
                            $.ajax({
                                data: JSON.stringify({
                                    'fecha_inicio': FechaDesde,
                                    'fecha_fin': FechaHasta
                                }),
                                type: 'POST',
                                url: '/gestionce/ListarVentasTotal',
                                contentType: "application/json; charset=utf-8",
                                dataType: "json",
                                success: function (msg) {
                                    options.success(msg);

                                    // SUma totdalde gastos
                                    var total = 0;
                                    msg.forEach(function (item) {
                                        total += parseFloat(item.Total);
                                    });

                                    $('#txt_ventas').html(total.toFixed(2));
                                    $('#hd_ventas').val(total.toFixed(2));

                                },
                                complete: function () {
                                    $('#loadMe').css('display', 'none');
                                    ListarGridEgresos();
                                }

                            });
                        }
                    }
                },
                selectable: "row",
                sortable: true,
                height: 494,
                columns: [
                    {
                        field: 'DescTipo',
                        title: "<b style='color:#fff;font-weight:bold;'>Descripción</b>",
                        width: 10,
                        attributes: {
                            style: "font-size:11px;"
                        }
                    },
                    {
                        field: 'Total',
                        title: "<b style='color:#fff;font-weight:bold;'>Monto</b>",
                        width: 10,
                        attributes: {
                            style: "font-size:11px;"
                        }
                    }
                ],
                dataBound: function (e) {
                    this.element.find('tbody tr:first').addClass('k-state-selected')
                    this.select(this.tbody.find('>tr:first'));
                }
            });

        }

        function ListarGridEgresos() {

            var FechaDesde = kendo.toString($("#txtFechaDesde_Tab1").data('kendoDatePicker').value(), 'MM/dd/yyyy');
            var FechaHasta = kendo.toString($("#txtFechaHasta_Tab1").data('kendoDatePicker').value(), 'MM/dd/yyyy');

            $('#loadMe').css('display', 'block');
            $("#gridEgresos").empty();
            $("#gridEgresos").kendoGrid({
                dataSource: {
                    type: 'json',
                    transport: {
                        read: function (options) {
                            $.ajax({
                                data: JSON.stringify({
                                    'fecha_inicio': FechaDesde,
                                    'fecha_fin': FechaHasta
                                }),
                                type: 'POST',
                                url: '/gestionce/ListarEgresosTotal',
                                contentType: "application/json; charset=utf-8",
                                dataType: "json",
                                success: function (msg) {
                                    options.success(msg);

                                    // SUma totdalde gastos
                                    var total = 0;
                                    msg.forEach(function (item) {
                                        total += parseFloat(item.MontoEgreso);
                                    });

                                    $('#txt_egresos').html(total.toFixed(2));
                                    $('#hd_egresos').val(total.toFixed(2));

                                },
                                complete: function () {
                                    $('#loadMe').css('display', 'none');
                                    CalcularUtilidad();
                                }

                            });
                        }                      
                    }
                },
                selectable: "row",
                sortable: true,
                height: 494,
                columns: [
                    {
                        field: 'Descripcion',
                        title: "<b style='color:#fff;font-weight:bold;'>Descripción</b>",
                        width: 10,
                        attributes: {
                            style: "font-size:11px;"
                        }
                    },
                    {
                        field: 'MontoEgreso',
                        title: "<b style='color:#fff;font-weight:bold;'>Monto</b>",
                        width: 10,
                        attributes: {
                            style: "font-size:11px;"
                        }
                    }
                ],
                dataBound: function (e) {
                    this.element.find('tbody tr:first').addClass('k-state-selected')
                    this.select(this.tbody.find('>tr:first'));
                }
            });

        }

        function CalcularUtilidad() {
            var ventas = $('#hd_ventas').val();
            var egresos = $('#hd_egresos').val();
            var utitlidad = parseFloat(ventas - egresos);

            $('#txt_utilidad').html(utitlidad.toFixed(2));
        }
    

        //HISTORIAL DE GASTOS
        function ListarTipoEgresos() {

            document.getElementById('loadMe').style.display = 'block';
            var TipoGasto = $("#ddlHistorial_TipoGasto").kendoDropDownList({
                optionLabel: "Todos",
                dataTextField: "Descripcion",
                dataValueField: "Codigo",
                dataSource: {
                    serverFiltering: false,
                    transport: {
                        read: function (options) {
                            $.ajax({
                                type: "POST",
                                url: "/gestionce/ListarTipoEgreso",
                                contentType: "application/json; charset=utf-8",
                                dataType: "json",
                                success: function (msg) {
                                    options.success(msg);
                                  
                                }, complete: function () {
                                    document.getElementById('loadMe').style.display = 'none';
                                }
                            });
                        }
                    }
                }, change: function () {
                    $('#hdHistorial_TipoGasto').val(TipoGasto.value());
                }
            }).data("kendoDropDownList");

        }

        function ListarCountersTotales() {

            document.getElementById('loadMe').style.display = 'block';
            var Counters = $("#ddlHistorial_Counter").kendoDropDownList({
                optionLabel: "Todos Counter",
                dataTextField: "NombreCompleto",
                dataValueField: "NombreCompleto",
                dataSource: {
                    serverFiltering: false,
                    transport: {
                        read: function (options) {
                            $.ajax({
                                type: "POST",
                                url: "/gestionce/ListarCounters",
                                contentType: "application/json; charset=utf-8",
                                dataType: "json",
                                success: function (msg) {
                                    options.success(msg);
                                    $('#hdHistorial_CountersTotales').val(Counters.value());
                                }, complete: function () {
                                    document.getElementById('loadMe').style.display = 'none';
                                }
                            });
                        }
                    }
                }, change: function () {
                    $('#hdHistorial_CountersTotales').val(Counters.value());
                }
            }).data("kendoDropDownList");
        }

        //EXPORTAR HISTORIAL DE GASTOS
        //EXPORTAR ASISTENCIA PERSONAL ADMINISTRATIVO
        function ExportarExcel_HistorialGastos() {

            var CodigoUnidadNegocio = getCookie('_CodigoUnidadNegocio_Business');
            var CodigoSede = getCookie('_CodigoSede_Business');
            var FechaInicio = kendo.toString($("#txtHistorial_FechaDesde_Tab2").data('kendoDatePicker').value(), 'MM/dd/yyyy');
            var FechaFin = kendo.toString($("#txtHistorial_FechaHasta_Tab2").data('kendoDatePicker').value(), 'MM/dd/yyyy');
            var Vendedor = $('#hdHistorial_CountersTotales').val() == 'Todos Counter' ? '' : $('#hdHistorial_CountersTotales').val();
            var Turno = 0;//$('#hdTurnosEmpresaTotales').val() == '' ? '0' : $('#hdTurnosEmpresaTotales').val();
            var TipoEgreso = $("#ddlHistorial_TipoGasto").data("kendoDropDownList").value() == '' ? 0 : $("#ddlHistorial_TipoGasto").data("kendoDropDownList").value();
            var TipoDocumento = $("#ddlHistorial_TipoDocumento").data("kendoDropDownList").value();

            var data = new FormData();
            data.append('CodigoUnidadNegocio', CodigoUnidadNegocio);
            data.append('CodigoSede', CodigoSede);
            data.append('FechaInicio', FechaInicio);
            data.append('FechaFin', FechaFin);
            data.append('Vendedor', Vendedor);
            data.append('Turno', Turno);
            data.append('TipoEgreso', TipoEgreso);
            data.append('TipoDocumento', TipoDocumento);

            var xhr = new XMLHttpRequest();
            xhr.open('POST', '/ExportarExcel/Appsfit/ExportarHistorialGastos.ashx', true);
            xhr.responseType = 'blob';
            xhr.onload = function (e) {
                if (this.status == 200) {
                    var blob = new Blob([this.response], { type: 'application/vnd.ms-excel' });
                    var downloadUrl = URL.createObjectURL(blob);
                    var a = document.createElement("a");
                    a.href = downloadUrl;
                    a.download = "HistorialGastos.xls";
                    a.style.display = "none";
                    document.body.appendChild(a);
                    a.click();
                } else {
                    alert('Unable to download excel.')
                }
            };
            xhr.send(data);

        }

        function uspReporteEgresoRangoFechas_Paginacion() {

            document.getElementById('loadMe').style.display = 'block';
            
            var FechaInicio = kendo.toString($("#txtHistorial_FechaDesde_Tab2").data('kendoDatePicker').value(), 'MM/dd/yyyy');
            var FechaFin = kendo.toString($("#txtHistorial_FechaHasta_Tab2").data('kendoDatePicker').value(), 'MM/dd/yyyy');
            var Vendedor = $('#hdHistorial_CountersTotales').val() == 'Todos Counter' ? '' : $('#hdHistorial_CountersTotales').val();          
            var Turno = 0;//$('#hdTurnosEmpresaTotales').val() == '' ? '0' : $('#hdTurnosEmpresaTotales').val();
            var TipoEgreso = $("#ddlHistorial_TipoGasto").data("kendoDropDownList").value() == '' ? 0 : $("#ddlHistorial_TipoGasto").data("kendoDropDownList").value();
            var TipoDocumento = $("#ddlHistorial_TipoDocumento").data("kendoDropDownList").value();

            $("#gridHistorialEgresos").empty();
            $("#gridHistorialEgresos").kendoGrid({
                dataSource: {
                    type: "json",
                    transport: {
                        read: function (options) {
                            $.ajax({
                                type: "POST",
                                data: '{"FechaInicio":"' + FechaInicio + '","FechaFin":"' + FechaFin + '","Vendedor":"' + Vendedor + '","Turno":"' + Turno + '","TipoEgreso":"' + TipoEgreso + '","TipoDocumento":"' + TipoDocumento + '","PageNumber":"' + 1 + '"}',
                                url: "/gestionce/uspReporteEgresoRangoFechas_Paginacion",
                                contentType: "application/json; charset=utf-8",
                                dataType: "json",
                                success: function (msg) {
                                    options.success(msg);
                                }, complete: function () {
                                    uspReporteEgresoRangoFechas_NumeroRegistros(FechaInicio, FechaFin, Vendedor, Turno, TipoEgreso, TipoDocumento);
                                    document.getElementById('loadMe').style.display = 'none';
                                }
                            });
                        }
                    }
                },
                height: 525,
                columns: [{
                    field: "TipoEgresoDescripcion",
                    title: "<label style='text-align:left;color:white;'>Tipo de Egresos</ label>",
                    width: 10,
                    attributes: {
                        style: "font-size:11px;text-align:left;font-weight:bold;"
                    }
                }, {
                    field: "Descripcion",
                        title: "<center><label style='text-align:center;color:white;'>Descripcion</label></center>",
                    width: 15,
                    attributes: {
                        style: "font-size:11px;text-align:center;"
                    }
                }, {
                    field: "Observaciones",
                    title: "<center><label style='text-align:center;color:white;'>Observaciones</label></center>",
                    width: 10,
                    attributes: {
                        style: "font-size:11px;text-align:center;"
                    }
                }, {
                    field: "DescTipoMoneda",
                        title: "<center><label style='text-align:center;color:white;'>Tipo Doc</label></center>",
                    width: 5,
                    attributes: {
                        style: "font-size:11px;text-align:center;"
                    }
                }, {
                    field: "NumeroRecibo",
                        title: "<center><label style='text-align:center;color:white;'>Nro Documento</label></center>",
                    width: 5,
                    attributes: {
                        style: "font-size:11px;text-align:center;"
                    }
                }, {
                    field: "RZProveedor",
                    title: "<center><label style='text-align:center;color:white;'>Proveedor</label></center>",
                    width: 10,
                    attributes: {
                        style: "font-size:11px;text-align:center;"
                    }

                }, {
                    field: "RUCProveedor",
                    title: "<center><label style='text-align:center;color:white;'>RUC</label></center>",
                    width: 5,
                    attributes: {
                        style: "font-size:11px;text-align:center;"
                    }

                }, {
                    field: "UsuarioCreacion",
                        title: "<center><label style='text-align:center;color:white;'>Responsable</label></center>",
                    width: 5,
                    attributes: {
                        style: "font-size:11px;text-align:center;"
                    }

                }, {
                    field: "FechaHora",
                        title: "<center><label style='text-align:center;color:white;'>Fecha Hora.</label></center>",
                    width: 8,
                    template: "#= kendo.toString(kendo.parseDate(FechaHora, 'yyyy-MM-dd h:mm:ss tt'), 'dd/MM/yyyy h:mm:ss tt') #",
                    attributes: {
                        style: "font-size:11px;text-align:center;"
                    }

                }, {
                    field: "MontoEgreso",
                        title: "<center><label style='text-align:center;color:white;'>Monto</label></center>",
                    width: 3,
                    attributes: {
                        style: "font-size:11px;text-align:center;color:red;font-weight:bold;"
                    }

                }]

            });
        }

        function uspReporteEgresoRangoFechas_Changue() {

            document.getElementById('loadMe').style.display = 'block';

            var FechaInicio = kendo.toString($("#txtFechaVentasHechaTotales").data('kendoDatePicker').value(), 'MM/dd/yyyy');
            var FechaFin = kendo.toString($("#txtFechaVentaFinTotales").data('kendoDatePicker').value(), 'MM/dd/yyyy');
            var Vendedor = $('#hdNombreVendedorTotales').val() == '' ? '' : $('#hdNombreVendedorTotales').val();            
            var Turno = 0;//$('#hdTurnosEmpresaTotales').val() == '' ? '0' : $('#hdTurnosEmpresaTotales').val();            
            var TipoEgreso = $("#ddlTipoGastos_TipoTipo_admin").data("kendoDropDownList").value() == '' ? 0 : $("#ddlTipoGastos_TipoTipo_admin").data("kendoDropDownList").value();
            var TipoDocumento = $("#ddlGastos_TipoComprobante_admin").data("kendoDropDownList").value();
            var PageNumber = $("#ddlPaginacionEgresos").data("kendoDropDownList").value();

            $("#gridHistorialEgresos").empty();
            $("#gridHistorialEgresos").kendoGrid({
                dataSource: {
                    type: "json",
                    transport: {
                        read: function (options) {
                            $.ajax({
                                type: "POST",
                                data: '{"FechaInicio":"' + FechaInicio + '","FechaFin":"' + FechaFin + '","Vendedor":"' + Vendedor + '","Turno":"' + Turno + '","TipoEgreso":"' + TipoEgreso + '","TipoDocumento":"' + TipoDocumento + '","PageNumber":"' + PageNumber + '"}',
                                url: "/gestionce/uspReporteEgresoRangoFechas_Paginacion",
                                contentType: "application/json; charset=utf-8",
                                dataType: "json",
                                success: function (msg) {
                                    options.success(msg);
                                }, complete: function () {
                                    document.getElementById('loadMe').style.display = 'none';
                                }
                            });
                        }
                    }
                },
                height: 525,
                columns: [{
                    field: "TipoEgresoDescripcion",
                    title: "<label style='text-align:left;color:white;'>Tipo de Egresos</ label>",
                    width: 10,
                    attributes: {
                        style: "font-size:11px;text-align:left;font-weight:bold;"
                    }
                }, {
                    field: "Descripcion",
                    title: "<center><label style='text-align:center;color:white;'>Descripcion</label></center>",
                    width: 15,
                    attributes: {
                        style: "font-size:11px;text-align:center;"
                    }
                }, {
                    field: "Observaciones",
                    title: "<center><label style='text-align:center;color:white;'>Observaciones</label></center>",
                    width: 10,
                    attributes: {
                        style: "font-size:11px;text-align:center;"
                    }
                }, {
                    field: "DescTipoMoneda",
                    title: "<center><label style='text-align:center;color:white;'>Tipo Doc</label></center>",
                    width: 5,
                    attributes: {
                        style: "font-size:11px;text-align:center;"
                    }
                }, {
                    field: "NumeroRecibo",
                    title: "<center><label style='text-align:center;color:white;'>Nro Documento</label></center>",
                    width: 5,
                    attributes: {
                        style: "font-size:11px;text-align:center;"
                    }
                }, {
                    field: "RZProveedor",
                    title: "<center><label style='text-align:center;color:white;'>Proveedor</label></center>",
                    width: 10,
                    attributes: {
                        style: "font-size:11px;text-align:center;"
                    }

                }, {
                    field: "RUCProveedor",
                    title: "<center><label style='text-align:center;color:white;'>RUC</label></center>",
                    width: 5,
                    attributes: {
                        style: "font-size:11px;text-align:center;"
                    }

                }, {
                    field: "UsuarioCreacion",
                    title: "<center><label style='text-align:center;color:white;'>Responsable</label></center>",
                    width: 5,
                    attributes: {
                        style: "font-size:11px;text-align:center;"
                    }

                }, {
                    field: "FechaHora",
                    title: "<center><label style='text-align:center;color:white;'>Fecha Hora.</label></center>",
                    width: 8,
                    template: "#= kendo.toString(kendo.parseDate(FechaHora, 'yyyy-MM-dd h:mm:ss tt'), 'dd/MM/yyyy h:mm:ss tt') #",
                    attributes: {
                        style: "font-size:11px;text-align:center;"
                    }

                }, {
                    field: "MontoEgreso",
                    title: "<center><label style='text-align:center;color:white;'>Monto</label></center>",
                    width: 3,
                    attributes: {
                        style: "font-size:11px;text-align:center;color:red;font-weight:bold;"
                    }

                }]
            });
        }

        function uspReporteEgresoRangoFechas_NumeroRegistros(FechaInicio, FechaFin, Vendedor, Turno, TipoEgreso, TipoDocumento) {
            
            $.ajax({
                data: '{"FechaInicio":"' + FechaInicio + '","FechaFin":"' + FechaFin + '","Vendedor":"' + Vendedor + '","Turno":"' + Turno + '","TipoEgreso":"' + TipoEgreso + '","TipoDocumento":"' + TipoDocumento + '","Tipo":"' + 1 + '"}',
                type: "POST",
                url: "/gestionce/uspReporteEgresoRangoFechas_NumeroRegistros",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (msg) {
                    $('#lblcantidadEgreso').html(msg.CantidadRegistros);
                    $('#lblTotalDia').html(msg.TotalGasto);
                    $('#lblTotalIgv').html(msg.Igv);
                    $('#lblTotalSubTotal').html(msg.SubTotal);

                    ddlListaPaginasEgresos(msg.CantidadRegistros, msg.TamanioPagina);
                }, complete: function () {

                }
            });

        }

        function ddlListaPaginasEgresos(CantidadTotalFilas, TamanioPagina) {

            var CantidadPaginas = parseInt(CantidadTotalFilas / TamanioPagina) + 1;

            var htmlOpcion = "";
            for (var i = 1; i <= CantidadPaginas; i++) {
                htmlOpcion += "<option value='" + i + "'> " + i + " </option>";
            }

            $('#ddlPaginacionEgresos').html(htmlOpcion);
            $("#ddlPaginacionEgresos").kendoDropDownList({
                change: function () {
                    uspReporteEgresoRangoFechas_Changue();
                }
            });

        }


        function getCookie(cname) {
            var name = cname + "=";
            var ca = document.cookie.split(';');
            for (var i = 0; i < ca.length; i++) {
                var c = ca[i].trim();
                if (c.indexOf(name) == 0) return c.substring(name.length, c.length);
            }
            return "";
        }

    </script>


}

