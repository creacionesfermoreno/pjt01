
@{
    ViewBag.Title = "login";
    Layout = "~/Views/Shared/_LayoutAppfitTienda2.cshtml";
}

<style>

    a.social_bt.facebook {
        background: #1877f2;
    }

    .borderValidacionFacebook {
        border: 1px #25c125 solid;
    }

    .modal-backdrop {
        display: none;
    }

    .modal-content {
        margin-top: 150px;
    }

    .modal {
        display: none;
        background-color: rgba(0, 0, 0, 0.77);
    }
</style>

<main class="bg_gray">

    <div class="container margin_30">
        <div class="page_header">
            <div class="breadcrumbs">
                <ul>
                    <li><a href="@Url.Action("Index","tienda",new {id= HttpContext.Current.Request.Cookies["_SubDominio_PersonaTiendaVirtual"].Value})">Tienda</a></li>
                    <li>Login</li>
                </ul>
            </div>
            <h1>Inicia sesión o crea una cuenta</h1>
        </div>
        <!-- /page_header -->
        <div class="row justify-content-center">
            <div class="col-xl-6 col-lg-6 col-md-8">
                <div class="box_account">
                    <h3 class="client" style="text-align:center;">INICIAR SESIÓN</h3>

                    <div class="form_container">

                        <div class="row no-gutters">
                            <div class="col-lg-12 pr-lg-1">
                                <button id="loginFacebook" class="btn_1 full-width facebook" style="background-color:#1877f2;">
                                    <i class="ti-facebook"></i>
                                    Ingresar con Facebook
                                </button>
                            </div>
                        </div>
                        <div class="clearfix add_bottom_15">
                            <div class="checkboxes float-left">
                                <label class="container_check">
                                    Recuérdame
                                    <input type="checkbox">
                                    <span class="checkmark"></span>
                                </label>
                            </div>
                            <div class="float-right"><a id="forgot" href="javascript:void(0);">¿Contraseña perdida?</a></div>
                        </div>
                        <div class="divider"><span></span></div>
                        <div class="row no-gutters">
                            <div class="col-lg-12 pr-lg-1">
                                <center>
                                    <img id="imgPersona" src="" alt="" />
                                </center>
                            </div>

                        </div>
                        <div class="divider"><span></span></div>
                        <div class="form-group" style="display:none;">
                            <input type="email" class="form-control" name="user" id="txtUsuarioLogin_Correo" placeholder="Correo*">
                        </div>
                        <div class="form-group" style="display:none;">
                            <input type="password" class="form-control" name="password" id="txtUsuarioLogin_Contrasenia" value="" placeholder="Contraseña*">
                        </div>

                        <div class="text-center" style="display:none;">

                        </div>
                        <div id="forgot_pw" style="display:none;">
                            <div class="form-group">
                                <input type="email" class="form-control" name="email_forgot" id="email_forgot" placeholder="Type your email">
                            </div>
                            <p>A new password will be sent shortly.</p>
                            <div class="text-center"><input type="submit" value="Reset Password" class="btn_1"></div>
                        </div>
                    </div>

                    <!-- /form_container -->
                </div>
                <!-- /box_account -->
                <div class="row">
                    <div class="col-md-6 d-none d-lg-block">
                        <ul class="list_ok">
                            <li>Control de ubicación de calidad</li>
                            <li>Protección de Datos</li>
                        </ul>
                    </div>
                    <div class="col-md-6 d-none d-lg-block">
                        <ul class="list_ok">
                            <li>Pagos seguros</li>
                            <li>Soporte 24/7</li>
                        </ul>
                    </div>
                </div>
                <!-- /row -->
            </div>
            <div class="col-xl-6 col-lg-6 col-md-8">
                <div class="box_account">
                    <h3 class="new_client" style="text-align:center;">CREAR CUENTA</h3>
                    <div class="divider"><span></span></div>
                    <div class="form_container">
                        <div class="form-group">
                            <a id="validarFacebook" href="#0" class="social_bt facebook">Validar mi Facebook</a>
                        </div>

                        <div class="row no-gutters">
                            <div class="col-6 pr-1">
                                <div class="form-group">
                                    <div class="custom-select-form">
                                        <select id="txtUsuario_CodigoPais" class="wide add_bottom_10" name="country" disabled>
                                            <option value="190">Alaska</option>
                                            <option value="355">Albania</option>
                                            <option value="49">Alemania</option>
                                            <option value="376">Andorra</option>
                                            <option value="244">Angola</option>
                                            <option value="966">Arabia Saudí</option>
                                            <option value="213">Argelia</option>
                                            <option value="54">Argentina</option>
                                            <option value="374">Armenia</option>
                                            <option value="61">Australia</option>
                                            <option value="43">Austria</option>
                                            <option value="973">Bahreim</option>
                                            <option value="880">Bangladesh</option>
                                            <option value="32">Bélgica</option>
                                            <option value="591">Bolivia</option>
                                            <option value="387">Bosnia</option>
                                            <option value="55">Brasil</option>
                                            <option value="359">Bulgaria</option>
                                            <option value="238">Cabo Verde</option>
                                            <option value="855">Camboya</option>
                                            <option value="237">Camerún</option>
                                            <option value="1">Canadá</option>
                                            <option value="236">Centroafricana, Rep.</option>
                                            <option value="420">Checa, Rep.</option>
                                            <option value="56">Chile</option>
                                            <option value="86">China</option>
                                            <option value="357">Chipre</option>
                                            <option value="57">Colombia</option>
                                            <option value="242">Congo, Rep. del</option>
                                            <option value="243">Congo, Rep. Democ.</option>
                                            <option value="850">Corea, Rep. Democ.</option>
                                            <option value="82">Corea, Rep.</option>
                                            <option value="225">Costa de Marfil</option>
                                            <option value="506">Costa Rica</option>
                                            <option value="385">Croacia</option>
                                            <option value="53">Cuba</option>
                                            <option value="45">Dinamarca</option>
                                            <option value="180">Dominicana, Rep.</option>
                                            <option value="593">Ecuador</option>
                                            <option value="20">Egipto</option>
                                            <option value="503">El Salvador</option>
                                            <option value="971">Emiratos Árabes Unidos</option>
                                            <option value="421">Eslovaca, Rep.</option>
                                            <option value="386">Eslovenia</option>
                                            <option value="34">España</option>
                                            <option value="1">Estados Unidos</option>
                                            <option value="372">Estonia</option>
                                            <option value="251">Etiopía</option>
                                            <option value="63">Filipinas</option>
                                            <option value="358">Finlandia</option>
                                            <option value="33">Francia</option>
                                            <option value="956">Gibraltar</option>
                                            <option value="30">Grecia</option>
                                            <option value="299">Groenlandia</option>
                                            <option value="502">Guatemala
                                            <option value="240">Guinea Ecuatorial</option>
                                            <option value="509">Haití</option>
                                            <option value="180">Hawai</option>
                                            <option value="504">Honduras</option>
                                            <option value="852">Hong Kong</option>
                                            <option value="36">Hungría</option>
                                            <option value="91">India</option>
                                            <option value="62">Indonesia </option>
                                            <option value="98">Irán</option>
                                            <option value="964">Irak</option>
                                            <option value="353">Irlanda</option>
                                            <option value="354">Islandia</option>
                                            <option value="972">Israel</option>
                                            <option value="39">Italia</option>
                                            <option value="187">Jamaica</option>
                                            <option value="81">Japón</option>
                                            <option value="962">Jordania</option>
                                            <option value="254">Kenia</option>
                                            <option value="965">Kuwait</option>
                                            <option value="856">Laos</option>
                                            <option value="371">Letonia</option>
                                            <option value="961">Líbano</option>
                                            <option value="231">Liberia</option>
                                            <option value="218">Libia</option>
                                            <option value="41">Liechtenstein</option>
                                            <option value="370">Lituania</option>
                                            <option value="352">Luxemburgo </option>
                                            <option value="261">Madagascar </option>
                                            <option value="60">Malasia</option>
                                            <option value="356">Malta</option>
                                            <option value="212">Marruecos</option>
                                            <option value="596">Martinica</option>
                                            <option value="222">Mauritania</option>
                                            <option value="52">México</option>
                                            <option value="373">Moldavia</option>
                                            <option value="377">Mónaco</option>
                                            <option value="976">Mongolia</option>
                                            <option value="258">Mozambique</option>
                                            <option value="264">Namibia</option>
                                            <option value="977">Nepal</option>
                                            <option value="505">Nicaragua</option>
                                            <option value="234">Nigeria</option>
                                            <option value="47">Noruega</option>
                                            <option value="64">Nueva Zelanda</option>
                                            <option value="31">Países Bajos </option>
                                            <option value="92">Pakistán</option>
                                            <option value="507">Panamá</option>
                                            <option value="595">Paraguay</option>
                                            <option selected value="51">Perú</option>
                                            <option value="48">Polonia</option>
                                            <option value="351">Portugal</option>
                                            <option value="178">Puerto Rico</option>
                                            <option value="974">Qatar</option>
                                            <option value="44">Reino Unido</option>
                                            <option value="40">Rumania</option>
                                            <option value="7">Rusia</option>
                                            <option value="378">San Marino</option>
                                            <option value="221">Senegal</option>
                                            <option value="65">Singapur</option>
                                            <option value="963">Siria</option>
                                            <option value="252">Somalia</option>
                                            <option value="94">Sri-Lanka</option>
                                            <option value="27">Sudáfrica</option>
                                            <option value="249">Sudán</option>
                                            <option value="46">Suecia</option>
                                            <option value="41">Suiza</option>
                                            <option value="66">Tailandia</option>
                                            <option value="886">Taiwan</option>
                                            <option value="255">Tanzania</option>
                                            <option value="216">Túnez</option>
                                            <option value="90">Turquía</option>
                                            <option value="380">Ucrania</option>
                                            <option value="256">Uganda</option>
                                            <option value="598">Uruguay</option>
                                            <option value="39">Vaticano</option>
                                            <option value="58">Venezuela</option>
                                            <option value="84">Vietnam</option>
                                            <option value="967">Yemen</option>
                                            <option value="381">Yugoslavia</option>
                                            <option value="260">Zambia</option>
                                            <option value="263">Zimbawe</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="col-6 pl-1">
                                <div class="form-group">
                                    <input type="text" class="form-control" id="txtUsuario_PhoneNumber" name="request.PhoneNumber" placeholder="Ingrese su whatsapp *">
                                </div>
                            </div>
                        </div>
                        <div class="private box">
                            <div class="row no-gutters">
                                <div class="col-6 pr-1">
                                    <div class="form-group">
                                        <input id="txtUsuario_Correo" type="email" class="form-control" name="request.Email" placeholder="Correo*">
                                    </div>
                                </div>
                                <div class="col-6 pl-1">
                                    <div class="form-group">
                                        <input id="txtUsuario_Identificación" type="text" name="request.Identificacion" class="form-control" placeholder="DNI, Nro Pasaporte*">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group" style="display:none;">
                            <input id="txtUsuario_PasswordHash" type="password" class="form-control" name="request.PasswordHash" value="" placeholder="Contraseña*" disabled>
                        </div>

                        <div class="private box">
                            <div class="row no-gutters">
                                <div class="col-6 pr-1">
                                    <div class="form-group">
                                        <input id="txtUsuario_Nombres" type="text" name="request.Nombres" class="form-control" placeholder="Nombre*" disabled>
                                    </div>
                                </div>
                                <div class="col-6 pl-1">
                                    <div class="form-group">
                                        <input id="txtUsuario_Apellidos" type="text" name="request.Apellidos" class="form-control" placeholder="Apellidos*" disabled>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <center>
                                <img id="imgValidacion" style="border-radius:150px;width:150px;height:140px;" src="http://graph.facebook.com/undefined/picture?type=large" alt="foto" />
                            </center>
                        </div>
                        <hr>
                        <div class="form-group">
                            <label class="container_check">
                                Aceptar <a href="#0">términos y condiciones</a>
                                <input type="checkbox">
                                <span class="checkmark"></span>
                            </label>
                        </div>
                        <div class="text-center">
                            <button onclick="RegistrarUsuario();" class="btn_1 full-width">Completar registro</button>
                        </div>
                    </div>
                    <!-- /form_container -->
                </div>
                <!-- /box_account -->
            </div>
        </div>
        <!-- /row -->
    </div>

</main>

<div id="modalAvisoLogin" class="popup_wrapper" style="display:none;">
    <div class="popup_content" style="text-align:center;padding: 54px;">
        <span class="popup_close" onclick="event_cerrarmodalAvisoCheckout();">Cerrar</span>
        <div class="row no-gutters">

            <div class="content">
                <div class="wrapper">
                    <h3>Error: Esta cuenta no existe!</h3>
                    <p>Te recomendamos ir a CREAR CUENTA.</p>
                </div>
            </div>
        </div>
        <!-- row -->
    </div>
</div>

<div id="modalAviso" class="popup_wrapper" style="display:none;">
    <div class="popup_content" style="text-align:center;padding: 54px;">
        <span class="popup_close" onclick="event_cerrarmodalAvisoCheckout();">Close</span>
        <div class="row no-gutters">

            <div class="content">
                <div class="wrapper">
                    <h3>Error: Esta cuenta ya existe!</h3>
                    <p>Te recomendamos ir a INICIAR SESIÓN.</p>
                </div>
            </div>
        </div>
        <!-- row -->
    </div>
</div>


@section Scripts {

    @System.Web.Optimization.Scripts.Render("~/Scripts/plugins/jquery-ui/jquery-ui.js")
    @System.Web.Optimization.Scripts.Render("~/Scripts/plugins/jquery-ui/jquery-ui.min.js")

    @System.Web.Optimization.Scripts.Render("~/Resource/UserControl.Helper.js")

    @System.Web.Optimization.Scripts.Render("~/Scripts/jquery.min.js")
    @System.Web.Optimization.Scripts.Render("~/Scripts/plugins/jsKendo/angular.min.js")
    @System.Web.Optimization.Scripts.Render("~/Scripts/plugins/jsKendo/kendo.all.min.js")

    @System.Web.Optimization.Scripts.Render("~/Scripts/jsFacebook/configuracionfacebook.js")
    
    <script type="text/javascript">

        $(document).ready(function () {
            leerMenu();

        });

        function RegistrarUsuario() {

            var Accion = 'N';
            var entidad = {};

            entidad.FullName = ConvertToStringFromObject($('input[id="txtUsuario_Nombres"]').val()) + ' ' + ConvertToStringFromObject($('input[id="txtUsuario_Apellidos"]').val());
            entidad.Nombres = ConvertToStringFromObject($('input[id="txtUsuario_Nombres"]').val());
            entidad.Apellidos = ConvertToStringFromObject($('input[id="txtUsuario_Apellidos"]').val());
            entidad.UserName = ConvertToStringFromObject($('input[id="txtUsuario_PasswordHash"]').val());
            entidad.PasswordHash = ConvertToStringFromObject($('input[id="txtUsuario_PasswordHash"]').val());
            entidad.Identificacion = ConvertToStringFromObject($('input[id="txtUsuario_Identificación"]').val());
            entidad.Email = ConvertToStringFromObject($('input[id="txtUsuario_Correo"]').val());
            entidad.PhoneNumber = ConvertToStringFromObject($('input[id="txtUsuario_PhoneNumber"]').val());
            entidad.PasswordConfirmacion = ConvertToStringFromObject($('input[id="txtUsuario_PasswordHash"]').val());
            entidad.Photo = $('#imgValidacion').attr('src');
            entidad.Accion = Accion;

            if (IsUndefinedOrNullOrEmpty($('input[id="txtUsuario_Nombres"]').val())) {
                $.bootstrapGrowl("Error, Falta ingresar su nombre!", { type: 'danger', width: 'auto' });
                return;
            } if (IsUndefinedOrNullOrEmpty($('input[id="txtUsuario_Apellidos"]').val())) {
                $.bootstrapGrowl("Error, Falta ingresar sus apellidos!", { type: 'danger', width: 'auto' });
                return;
            } else if (IsUndefinedOrNullOrEmpty(entidad.UserName)) {
                $.bootstrapGrowl("Error, Falta ingresar su correo!", { type: 'danger', width: 'auto' });
                return;
            } else if (IsUndefinedOrNullOrEmpty(entidad.PasswordHash)) {
                $.bootstrapGrowl("Error, Falta ingresar su contraseña!", { type: 'danger', width: 'auto' });
                return;
            } else if (IsUndefinedOrNullOrEmpty(entidad.Email)) {
                $.bootstrapGrowl("Error, Falta ingresar su correo!", { type: 'danger', width: 'auto' });
                return;
            } else if (IsUndefinedOrNullOrEmpty(entidad.PhoneNumber)) {
                $.bootstrapGrowl("Error, Falta ingresar su whatsapp!", { type: 'danger', width: 'auto' });
                return;
            }
            else if (entidad.PasswordHash != entidad.PasswordConfirmacion) {
                $.bootstrapGrowl("Error, La confirmación de contraseña deben ser iguales!", { type: 'danger', width: 'auto' });
                return;
            }

            entidad.PhoneNumber = ConvertToStringFromObject($('select[id="txtUsuario_CodigoPais"] option:selected').val()) + '' + entidad.PhoneNumber;

            $('button').attr('disabled', 'disabled');
            var metodoCorrecto = function (msg) {

                if (msg == 1) {

                    $('button').removeAttr('disabled');
                    $('#modalAviso').modal('show');
                } else if (msg == 0) {
                    var dominio = getCookie("_SubDominio_PersonaTiendaVirtual");
                    window.location.href = "/tienda/checkout/" + dominio;
                }
                else {
                    alert("Error, vuelva a intentar nuevamente!");
                }
            };
            var metodoError = function (msg) {
                alert(msg);
            };
            var request = {
                request: entidad
            };
            LlamarAJAX("/tienda/GuardarPersonaTiendaVirtual", request, metodoCorrecto, metodoError);

        }

        function getCookie(cname) {
            var name = cname + "=";
            var ca = document.cookie.split(';');
            for (var i = 0; i < ca.length; i++) {
                var c = ca[i].trim();
                if (c.indexOf(name) == 0) return c.substring(name.length, c.length);
            }
            return "";
        }

        function leerMenu() {

            var content_Catgorias = new Array();

            let menuLS;
            menuLS = obtenerMenuLocalStorage();
            menuLS.forEach(function (menu) {

                if (menu.CodigoMenuSuperior == 0) {
                    content_Catgorias.push('<li class="megamenu submenu">');
                    content_Catgorias.push('    <a href="javascript:void(0);" class="show-submenu-mega">' + menu.Descripcion + '</a>');
                    content_Catgorias.push('    <div class="menu-wrapper">');
                    content_Catgorias.push('        <div class="row small-gutters">');

                    menuLS.forEach(function (menuhijo) {
                        if (menu.CodigoMenu == menuhijo.CodigoMenuSuperior) {
                            var url = '/tienda/categoria/' + getCookie('_SubDominio_PersonaTiendaVirtual') + '?Idcat=' + menuhijo.CodigoImagen;
                            content_Catgorias.push('<div class="col-lg-3">');
                            content_Catgorias.push('    <h3 style="cursor:pointer;" ><a href="' + url + '">' + menuhijo.Descripcion + '</a></h3>');
                            content_Catgorias.push('</div>');
                        }
                    });

                    content_Catgorias.push('        </div>');
                    content_Catgorias.push('   </div>');
                    content_Catgorias.push('</li>');
                }

            });

            $('#ulCategorias').html(content_Catgorias.join(' '));
        }

        function event_cerrarmodalAvisoCheckout() {
            $('#modalAviso').modal('hide');
            $('#modalAvisoLogin').modal('hide');
        }

    </script>
}